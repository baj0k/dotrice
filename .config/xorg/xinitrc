#!/bin/sh

# Source xresources
[ -x /usr/bin/xrdb ] && /usr/bin/xrdb -merge "${XDG_CONFIG_HOME:?}/xorg/xresources" &

# Increase key speed, set dpms parameters and set wallpaper
[ -x /usr/bin/xset ] && /usr/bin/xset r rate 300 50 &
[ -x /usr/bin/xset ] && /usr/bin/xset s off -dpms &
[ -x /usr/bin/xwallpaper ] && /usr/bin/xwallpaper --zoom "${XDG_DATA_HOME:?}/wall" &

# Display configuration
[ -x /usr/bin/autorandr ] && /usr/bin/autorandr --default &
[ -x /usr/bin/redshift ] && /usr/bin/redshift -P -O 4200 &

# Tray
#[ -f /usr/bin/blueman-applet ] && /usr/bin/blueman-applet &
#[ -f /usr/bin/caprine ] && /usr/bin/caprine --minimize &
#[ -f /usr/bin/discord ] && /usr/bin/discord --start-minimized &
#[ -f /usr/bin/signal-desktop ] && /usr/bin/signal-desktop --start-in-tray &
#[ -f /usr/bin/spotify ] && /usr/bin/spotify & # TODO: currently doesn't start in tray

# Autostart
autostart="dunst firefox mpd spice-vdagent unclutter xcompmgr"
for program in ${autostart}; do
    /usr/bin/pidof -s "${program}" || [ -x "/usr/bin/${program}" ] && /usr/bin/setsid -f "/usr/bin/${program}"
done >/dev/null 2>&1

# Start WM
[ -x /usr/local/bin/dwmblocks ] && /usr/bin/setsid -f /usr/local/bin/dwmblocks
exec /usr/local/bin/dwm
