#!/bin/sh

# TODO: Remove this after fixing the network interfaces
sudo ip link set eth0 master br0 &

# Source xresources
[ -x xrdb ] && xrdb -merge "${XDG_CONFIG_HOME:?}/xorg/xresources" &

# Increase key speed, set dpms parameters and set wallpaper
[ -x xset ] && xset r rate 300 50 &
[ -x xset ] && xset s off -dpms &
[ -x xwallpaper ] && xwallpaper --zoom "${XDG_CACHE_HOME:?}/wall" &

# Display configuration
[ -x autorandr ] && autorandr --default &
[ -x redshift ] && redshift -P -O 4200 &

# Tray
#[ -f blueman-applet ] && blueman-applet &
#[ -f caprine ] && caprine --minimize &
#[ -f discord ] && discord --start-minimized &
#[ -f signal-desktop ] && signal-desktop --start-in-tray &
#[ -f spotify ] && spotify & # TODO: currently doesn't start in tray

# Autostart
autostart="dunst firefox mpd spice-vdagent unclutter xcompmgr"
for program in ${autostart}; do
    pidof -s "${program}" || [ -x "${program}" ] && setsid -f "${program}"
done >/dev/null 2>&1

# Start WM
[ -x dwmblocks ] && setsid -f dwmblocks
exec dwm
