#!/bin/sh

TMPFILE=$(/usr/bin/mktemp) && trap '/usr/bin/rm -rf "$TMPFILE"' EXIT
URLFILE="${XDG_CONFIG_HOME:=${HOME}/.config}/newsboat/urls"

# Get rss link from YouTube's channel page source
url=$(/usr/bin/curl -s "$(/usr/bin/xclip -o || true)" | /usr/bin/grep -o 'rssUrl\":\"[^"]*' | /usr/bin/cut -d \" -f 3)

[ -z "${url}" ] && /usr/bin/notify-send "No rss url found" && exit 0
tag=$(printf "feed\nvideo\naudio" | /usr/local/bin/dmenu -i -p "Tag:")
title=$(/usr/local/bin/dmenu -i -p "Name: ~${tag}: " <&-)

echo "${url}" \""${tag}"\" \"\~"${tag}": "${title}"\" >> "${URLFILE}"
/usr/bin/sort -f -k 3 -k 2 < "${URLFILE}" > "${TMPFILE}"
/usr/bin/mv "${TMPFILE}" "${URLFILE}"
